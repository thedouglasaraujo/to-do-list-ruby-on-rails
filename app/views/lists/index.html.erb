<h1 class="title-page">Minhas Listas</h1>

<%= link_to 'Criar Lista', new_list_path, class: "btn btn-primary create-btn" %>

<div class="cards-container">
  <% @lists.each do |list| %>
    <div class="card" style="padding: 20px; border: 1px solid #ccc; border-radius: 5px; background-color: #fff; text-align: center; transition: transform 0.2s; position: relative;">
      <!-- Link para o card -->
      <%= link_to list_path(list), style: "display: block; width: 100%; height: 100%; position: absolute; inset: 0; z-index: 1;" do %>
      <% end %>

      <!-- Conteúdo do Card -->
      <h2 style="margin-bottom: 10px; font-size: 18px; color: #333; position: relative; z-index: 2;">
        <%= list.title %>
      </h2>

      <!-- Exibição de quantidade de itens e porcentagem de conclusão -->
      <p style="font-size: 14px; color: #666; position: relative; z-index: 2;">
        <%= "#{list.items.count} itens" %> | 
        <% if list.items.count > 0 %>
          <%= "#{((list.items.where(done: true).count.to_f / list.items.count) * 100).round(0)}% concluído" %>
        <% else %>
          Nenhum item adicionado
        <% end %>
      </p>

      <!-- Barra de progresso personalizada -->
      <div class="progress-bar-container" style="width: 100%; height: 10px; background-color: #e0e0e0; border-radius: 5px; overflow: hidden;">
        <% if list.items.count > 0 %>
          <div class="progress-bar" 
               style="width: <%= (list.items.where(done: true).count.to_f / list.items.count) * 100 %>%; 
                      height: 100%; 
                      background-color: #4caf50;"></div>
        <% end %>
      </div>

      <!-- Botões de ações -->
      <div class="card-actions" style="display: flex; justify-content: space-around; margin-top: 10px; position: relative; z-index: 3;">
        <%= link_to 'Ver', list_path(list), class: "btn btn-secondary btn-sm" %>
        <%= link_to 'Editar', edit_list_path(list), class: "btn btn-primary btn-sm" %>

        <!-- Botão para abrir o modal -->
        <%= link_to 'Excluir', '#', class: 'btn btn-danger btn-sm', data: { bs_toggle: 'modal', bs_target: "#confirmModal-#{list.id}" } %>
      </div>
    </div>

    <!-- Modal de Confirmação -->
    <div class="modal fade" id="confirmModal-<%= list.id %>" tabindex="-1" aria-labelledby="confirmModalLabel-<%= list.id %>" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="confirmModalLabel-<%= list.id %>">Confirmação</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
          </div>
          <div class="modal-body">
            Tem certeza de que deseja excluir esta lista? Esta ação não pode ser desfeita.
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
            <%= form_with url: list_path(list), method: :delete, html: { style: "display: inline;" } do %>
              <%= submit_tag 'Excluir', class: 'btn btn-danger' %>
            <% end %>
          </div>
        </div>
      </div>
    </div>
  <% end %>
</div>
